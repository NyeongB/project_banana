<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper
  PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
  "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
  
  
<mapper namespace="com.banana.user.IRestDAO">
	
	<select id="list" resultType="com.banana.user.RestDTO">
		SELECT J.NAME , J.SSN, J.TEL, J.ADDR, J.ID, J.EMAIL, BT.BANK_NAME AS BANKTYPENAME, J.ACCOUNT_USER AS ACCOUNTNAME, J.ACCOUNT AS ACCOUNT
	, (SELECT COUNT(*) FROM WARNING WHERE B_USER_CODE = R.B_USER_CODE) AS WARNING
	, NVL((SELECT SUM(POINT) FROM POINT_LIST WHERE B_USER_CODE = R.B_USER_CODE), 0) AS POINT 
	, (SELECT COUNT(*) FROM OUT WHERE B_USER_CODE = R.B_USER_CODE)AS OUT
	, NVL((SELECT SUM(CREDIT_SCORE) FROM CREDIT_SCORE WHERE B_USER_CODE = R.B_USER_CODE), 0)AS CREDITSCORE
	, NVL((SELECT SUM(BANANA_SCORE) FROM BANANA_SCORE WHERE B_USER_CODE = R.B_USER_CODE), 0)AS BANANASCORE
	, B.SDATE AS SDATE
	, TO_DATE((SELECT MAX(SDATE)FROM B_USER WHERE B_USER_CODE = R.B_USER_CODE), 'YYYY-MM-DD') AS RDATE
	, R.CHANGE_DATE AS CHANGEDATE
	FROM JOIN J RIGHT JOIN REST R
	ON J.B_USER_CODE = R.B_USER_CODE
	LEFT JOIN BANK_TYPE BT
	ON BT.BANK_TYPE_CODE = J.BANK_TYPE_CODE
	LEFT JOIN B_USER B
	ON B.B_USER_CODE = R.B_USER_CODE		
	</select>
	
	
</mapper>  