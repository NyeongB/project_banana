<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper
  PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
  "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
  
  
<mapper namespace="com.banana.user.IStopDAO">
	
	<select id="list" resultType="com.banana.user.StopDTO">
	SELECT J.ID,J.NAME, J.SSN, J.TEL, J.ADDR, J.EMAIL,NVL((SELECT AVG(CREDIT_SCORE) FROM CREDIT_SCORE WHERE P.B_USER_CODE = B_USER_CODE),0) AS CREDIT_SCORE
	, NVL((SELECT SUM(BANANA_SCORE) FROM BANANA_SCORE WHERE P.B_USER_CODE = B_USER_CODE), 0) AS BANANA_SCORE
	,NVL((SELECT SUM(POINT) FROM POINT_LIST WHERE B_USER_CODE=P.B_USER_CODE),0) AS POINT,
	U.SDATE, B.BANK_NAME, J.ACCOUNT_USER, J.ACCOUNT
	, NVL( (SELECT COUNT(*) FROM WARNING WHERE B_USER_CODE = P.B_USER_CODE),0) AS WARNING
	, NVL( (SELECT COUNT(*) FROM OUT WHERE B_USER_CODE = P.B_USER_CODE),0) AS OUT
	, P.EXPULSION_DATE
	FROM PERMANENT_EXPULSION P JOIN JOIN J
	ON J.B_USER_CODE = P.B_USER_CODE
	JOIN BANK_TYPE B
	ON B.BANK_TYPE_CODE = J.BANK_TYPE_CODE
	JOIN B_USER U
	ON U.B_USER_CODE = P.B_USER_CODE
	</select>
	
	
	
</mapper>  

