<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper
  PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
  "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
  
  
<mapper namespace="com.banana.user.ILeaveDAO">
	
	<select id="list" resultType="com.banana.user.LeaveDTO">
		SELECT J.NAME,J.SSN,J.TEL,J.ADDR,J.ID,J.EMAIL
		,NVL((SELECT SUM(CREDIT_SCORE) FROM CREDIT_SCORE WHERE C.B_USER_CODE=J.B_USER_CODE),0) AS CREDIT_SCORE
		,NVL((SELECT SUM(BANANA_SCORE) FROM BANANA_SCORE WHERE B_USER_CODE=J.B_USER_CODE),0) AS BANANA_SCORE
		,NVL((SELECT SUM(POINT) FROM POINT_LIST WHERE B_USER_CODE=J.B_USER_CODE),0) AS POINT
		,B.SDATE AS JOINDATE
		,K.BANK_NAME,J.ACCOUNT_USER
		,(SELECT COUNT(*) AS O_COUNT FROM OUT WHERE B_USER_CODE =J.B_USER_CODE) AS OUT_COUNT
		,(SELECT COUNT(*) AS O_COUNT FROM WARNING WHERE B_USER_CODE =J.B_USER_CODE) AS WARNING_COUNT
		,J.ACCOUNT,NVL(N.SDATE,TO_DATE('1111-11-11')) AS CONDATE
		,L.SDATE AS LEAVEDATE
		FROM LEAVE L JOIN B_USER B
		ON L.B_USER_CODE = B.B_USER_CODE
		    JOIN JOIN J 
		ON B.B_USER_CODE = J.B_USER_CODE
		    JOIN BANK_TYPE K
		ON J.BANK_TYPE_CODE = K.BANK_TYPE_CODE
		   LEFT JOIN POINT_LIST P
		ON J.B_USER_CODE = P.B_USER_CODE
		   LEFT JOIN CREDIT_SCORE C
		ON J.B_USER_CODE = C.B_USER_CODE
		   LEFT JOIN BANANA_SCORE S
		ON J.B_USER_CODE = S.B_USER_CODE
		   LEFT JOIN CONNECTION N
		ON J.B_USER_CODE = N.B_USER_CODE
		    LEFT JOIN OUT O
		ON J.B_USER_CODE = O.B_USER_CODE
		    LEFT JOIN WARNING W
		ON J.B_USER_CODE = W.B_USER_CODE
	</select>
	
	<insert id="leave">
	INSERT INTO LEAVE(LEAVE_CODE, B_USER_CODE, LEAVE_TYPE_CODE)
	 VALUES('LEA_U2'||SEQ_LEAVE_U.NEXTVAL, #{b_user_code},#{leave_type_code})
	</insert>
	
	<select id="getUser" resultType="java.lang.String">
	SELECT B_USER_CODE
	FROM JOIN
	WHERE ID=#{id}
	</select>
	
	
</mapper>  