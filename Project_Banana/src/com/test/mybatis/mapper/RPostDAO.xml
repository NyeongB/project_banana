<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper
  PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
  "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
  
  
<mapper namespace="com.banana.rent.IRPostDAO">

	<!--대분류 카테고리 선택  -->
	<select id="cateList" resultType="com.banana.rent.RCateDTO">
		SELECT R_CATE_BCODE, CATE_NAME, R_CATE_CODE
		FROM R_CATE
		WHERE R_CATE_BCODE = #{r_cate_bcode} AND R_CATE_MCODE IS NULL 
	</select>
	
	<!--소분류 카테고리 선택 -->
	<select id="cateMList" resultType="com.banana.rent.RCateDTO">
		SELECT R_CATE_CODE, CATE_NAME
		FROM R_CATE
		WHERE R_CATE_BCODE = #{r_cate_bcode}  AND R_CATE_MCODE = #{r_cate_code}
	</select>
	
	
	<!--대분류 카테고리 눌렀을 때 실시간 게시물  -->
	<select id="rCateMainList" resultType="com.banana.rent.RPostDTO">
		SELECT *
		FROM VIEW_RCATEMAINLIST
		WHERE  R_CATE_BCODE=  #{r_cate_bcode}
	</select>
	
	
	
	<!--중분류 카테고리 눌렀을 때 실시간 게시물  -->
	<select id="rCatemMainList" resultType="com.banana.rent.RPostDTO">
		SELECT *
		FROM VIEW_RCATEMAINLIST
		WHERE R_CATE_BCODE = #{r_cate_bcode} AND R_CATE_MCODE = #{r_cate_code} 
	</select>
	
	

	<!--관심카테고리 기반 추천 게시물  -->
	<select id="rCateList" resultType="com.banana.rent.RPostDTO">
		SELECT DISTINCT RP.TITLE , J.NICKNAME, FIRST_VALUE(PT.PHOTO) OVER (PARTITION BY PT.R_POST_CODE ORDER BY PT.R_PHOTO_CODE)AS PHOTO, RP.OFFER_LOC AS OFFERLOC, RP.COLLECT_LOC AS COLLECTLOC, RP.COST
		FROM R_POST RP LEFT JOIN JOIN J
		ON RP.B_USER_CODE = J.B_USER_CODE
		LEFT JOIN R_PHOTO PT
		ON RP.R_POST_CODE = PT.R_POST_CODE
		LEFT JOIN R_CATE C 
		ON RP.R_CATE_CODE = C.R_CATE_CODE
		WHERE C.R_CATE_BCODE = (SELECT R_CATE_CODE 
                        FROM R_CATE_INPUT
                        WHERE B_USER_CODE = 'USER36')
	</select>
	
	
	
	
	<!-- 빌려드립니다. 실시간 게시물 -->
	<select id="rnewList" resultType="com.banana.rent.RPostDTO">
	SELECT *    
	FROM VIEW_RCATEMAINLIST
	
	</select>


	<!-- 게시물 클릭 시 상품 페이지로 이동 -->
	<select id="rpostDetail" resultType="com.banana.rent.RPostDTO">
	SELECT *
	FROM VIEW_RPOSTDETAIL            
	WHERE R_POST_CODE = #{r_post_code}
	
	</select>


	<!-- 거래지역 불러오기 -->
	<select id="dealLoc" resultType="com.banana.rent.RPostDTO">
	SELECT LOC_NAME AS LOCNAME1, (SELECT L.LOC_NAME
	FROM R_POST R LEFT JOIN LOC L
	ON R.LOC_CODE = L.LOC_CODE
	WHERE R_POST_CODE = #{r_post_code}) AS LOCNAME2
	FROM LOC
	WHERE LOC_CODE    = (SELECT LOC_BCODE
    	                 FROM LOC
                         WHERE LOC_CODE = (SELECT LOC_CODE
                                           FROM R_POST
                                           WHERE R_POST_CODE = #{r_post_code}))
	
	
	</select>
	
	<!-- 상품등록 INSERT -->
	<!-- <select id="rpostinsert" resultType="com.banana.rent.RPostDTO">
	
	</select> -->




</mapper>


















